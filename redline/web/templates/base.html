<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}REDLINE - Financial Data Analyzer{% endblock %}</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
        <!-- Custom CSS -->
        <link href="{{ url_for('static', filename='css/main.css') }}" rel="stylesheet">
        <link href="{{ url_for('static', filename='css/themes.css') }}" rel="stylesheet">
        <link href="{{ url_for('static', filename='css/virtual-scroll.css') }}" rel="stylesheet">
        <link href="{{ url_for('static', filename='css/color-customizer.css') }}" rel="stylesheet">
    
    {% block extra_css %}{% endblock %}
</head>
<body class="theme-default">
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container-fluid">
            <a class="navbar-brand" href="{{ url_for('main.index') }}">
                <i class="fas fa-chart-line me-2"></i>REDLINE
            </a>
            
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('main.dashboard') }}">
                            <i class="fas fa-tachometer-alt me-1"></i>Dashboard
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('data.data_tab') }}">
                            <i class="fas fa-database me-1"></i>Data
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('analysis.analysis_tab') }}">
                            <i class="fas fa-chart-bar me-1"></i>Analysis
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('download.download_tab') }}">
                            <i class="fas fa-download me-1"></i>Download
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('converter.converter_tab') }}">
                            <i class="fas fa-exchange-alt me-1"></i>Converter
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('settings.settings_tab') }}">
                            <i class="fas fa-cog me-1"></i>Settings
                        </a>
                    </li>
                </ul>
                
                <ul class="navbar-nav">
                    <li class="nav-item dropdown">
                        <button class="btn btn-outline-light dropdown-toggle" type="button" id="themeDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="fas fa-palette me-1"></i>Theme
                        </button>
                        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="themeDropdown">
                            <li><h6 class="dropdown-header">Color Schemes</h6></li>
                            <li><a class="dropdown-item theme-option" href="#" data-theme="theme-default">
                                <i class="fas fa-circle text-primary me-2"></i>Default
                            </a></li>
                            <li><a class="dropdown-item theme-option" href="#" data-theme="theme-high-contrast">
                                <i class="fas fa-circle text-danger me-2"></i>High Contrast
                            </a></li>
                            <li><a class="dropdown-item theme-option" href="#" data-theme="theme-ocean">
                                <i class="fas fa-circle text-info me-2"></i>Ocean
                            </a></li>
                            <li><a class="dropdown-item theme-option" href="#" data-theme="theme-forest">
                                <i class="fas fa-circle text-success me-2"></i>Forest
                            </a></li>
                            <li><a class="dropdown-item theme-option" href="#" data-theme="theme-sunset">
                                <i class="fas fa-circle text-warning me-2"></i>Sunset
                            </a></li>
                            <li><a class="dropdown-item theme-option" href="#" data-theme="theme-monochrome">
                                <i class="fas fa-circle text-secondary me-2"></i>Monochrome
                            </a></li>
                            <li><a class="dropdown-item theme-option" href="#" data-theme="theme-dark">
                                <i class="fas fa-moon text-dark me-2"></i>Dark
                            </a></li>
                        </ul>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('main.help_page') }}">
                            <i class="fas fa-question-circle me-1"></i>Help
                        </a>
                    </li>
                    <li class="nav-item">
                        <span class="navbar-text">
                            <i class="fas fa-circle text-success me-1"></i>Online
                        </span>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <div class="col-md-2 sidebar">
                <div class="sidebar-content">
                    {% block sidebar %}
                    <div class="sidebar-section">
                        <h6 class="sidebar-title">Quick Actions</h6>
                        <div class="list-group list-group-flush">
                            <a href="{{ url_for('download.download_tab') }}" class="list-group-item list-group-item-action">
                                <i class="fas fa-download me-2"></i>Download Data
                            </a>
                            <a href="{{ url_for('data.data_tab') }}" class="list-group-item list-group-item-action">
                                <i class="fas fa-eye me-2"></i>View Data
                            </a>
                            <a href="{{ url_for('converter.converter_tab') }}" class="list-group-item list-group-item-action">
                                <i class="fas fa-exchange-alt me-2"></i>Convert Format
                            </a>
                            <a href="{{ url_for('analysis.analysis_tab') }}" class="list-group-item list-group-item-action">
                                <i class="fas fa-chart-bar me-2"></i>Analyze Data
                            </a>
                        </div>
                    </div>
                    
                    <div class="sidebar-section">
                        <h6 class="sidebar-title">Recent Files</h6>
                        <div id="recent-files" class="list-group list-group-flush">
                            <!-- Recent files will be loaded here -->
                        </div>
                    </div>
                    
                    <div class="sidebar-section">
                        <h6 class="sidebar-title">System Status</h6>
                        <div id="system-status">
                            <small class="text-muted">Loading...</small>
                        </div>
                    </div>
                    {% endblock %}
                </div>
            </div>
            
            <!-- Main Content Area -->
            <div class="col-md-10 main-content">
                {% block content %}
                <div class="content-header">
                    <h1 class="content-title">{% block page_title %}Welcome to REDLINE{% endblock %}</h1>
                    <p class="content-subtitle">{% block page_subtitle %}Financial Data Analyzer & Management Tool{% endblock %}</p>
                </div>
                
                <div class="content-body">
                    <!-- Content will be loaded here -->
                </div>
                {% endblock %}
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay" style="display: none;">
        <div class="loading-spinner">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <div class="loading-text mt-3">Processing...</div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container position-fixed top-0 end-0 p-3">
        <div id="toast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header">
                <i class="fas fa-info-circle text-primary me-2"></i>
                <strong class="me-auto">REDLINE</strong>
                <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
            </div>
            <div class="toast-body">
                <!-- Toast message will be inserted here -->
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    
            <!-- Custom JS -->
            <script src="{{ url_for('static', filename='js/main.js') }}"></script>
            <script src="{{ url_for('static', filename='js/virtual-scroll.js') }}"></script>
            <script src="{{ url_for('static', filename='js/color-customizer.js') }}"></script>
    
    {% block extra_js %}{% endblock %}
    
    <script>
        // Initialize page
        $(document).ready(function() {
            loadRecentFiles();
            loadSystemStatus();
        });
        
        // Load recent files
        function loadRecentFiles() {
            $.get('/api/files')
                .done(function(data) {
                    const container = $('#recent-files');
                    container.empty();
                    
                    if (data.files && data.files.length > 0) {
                        data.files.slice(0, 5).forEach(function(file) {
                            const item = $(`
                                <div class="list-group-item list-group-item-action">
                                    <div class="d-flex w-100 justify-content-between">
                                        <h6 class="mb-1">${file.name}</h6>
                                        <small>${formatFileSize(file.size)}</small>
                                    </div>
                                    <small class="text-muted">${formatDate(file.modified)}</small>
                                </div>
                            `);
                            container.append(item);
                        });
                    } else {
                        container.html('<small class="text-muted">No recent files</small>');
                    }
                })
                .fail(function() {
                    $('#recent-files').html('<small class="text-danger">Error loading files</small>');
                });
        }
        
        // Load system status
        function loadSystemStatus() {
            $.get('/status')
                .done(function(data) {
                    const container = $('#system-status');
                    const statusIcon = data.status === 'running' ? 'fas fa-circle text-success' : 'fas fa-circle text-danger';
                    
                    container.html(`
                        <div class="d-flex align-items-center mb-2">
                            <i class="${statusIcon} me-2"></i>
                            <span>${data.status}</span>
                        </div>
                        <div class="d-flex align-items-center mb-2">
                            <i class="fas fa-database me-2"></i>
                            <span>DB: ${data.database}</span>
                        </div>
                        <div class="d-flex align-items-center">
                            <i class="fas fa-file-alt me-2"></i>
                            <span>${data.supported_formats ? data.supported_formats.length : 0} formats</span>
                        </div>
                    `);
                })
                .fail(function() {
                    $('#system-status').html('<small class="text-danger">Status unavailable</small>');
                });
        }
        
        // Utility functions
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
        
        function formatDate(timestamp) {
            return new Date(timestamp * 1000).toLocaleDateString();
        }
        
        // Show loading overlay
        function showLoading(text = 'Processing...') {
            $('.loading-text').text(text);
            $('#loading-overlay').show();
        }
        
        // Hide loading overlay
        function hideLoading() {
            $('#loading-overlay').hide();
        }
        
        // Show toast notification
        function showToast(message, type = 'info') {
            const toast = $('#toast');
            const icon = type === 'success' ? 'fas fa-check-circle text-success' : 
                        type === 'error' ? 'fas fa-exclamation-circle text-danger' : 
                        'fas fa-info-circle text-primary';
            
            toast.find('.toast-header i').attr('class', icon);
            toast.find('.toast-body').text(message);
            
            const bsToast = new bootstrap.Toast(toast[0]);
            bsToast.show();
        }
    </script>
</body>
</html>
