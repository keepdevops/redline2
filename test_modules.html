<!DOCTYPE html>
<html>
<head>
    <title>Module Testing</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .test-result { margin: 10px 0; padding: 10px; border-radius: 3px; }
        .test-success { background-color: #d4edda; border: 1px solid #c3e6cb; color: #155724; }
        .test-error { background-color: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; }
        .test-info { background-color: #d1ecf1; border: 1px solid #bee5eb; color: #0c5460; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Module Testing</h1>
        
        <!-- Test 1: File Loader -->
        <div class="test-section">
            <h3>Test 1: File Loader Module</h3>
            <button id="testFileLoader" class="btn btn-primary">Test File Loader</button>
            <div id="fileLoaderResult"></div>
        </div>
        
        <!-- Test 2: File Selector -->
        <div class="test-section">
            <h3>Test 2: File Selector Module</h3>
            <select id="testFileSelect" class="form-select">
                <option value="">Select a file...</option>
            </select>
            <div id="fileSelectorResult"></div>
        </div>
        
        <!-- Test 3: Data Loader -->
        <div class="test-section">
            <h3>Test 3: Data Loader Module</h3>
            <button id="testDataLoader" class="btn btn-primary">Test Data Loader</button>
            <div id="dataLoaderResult"></div>
        </div>
        
        <!-- Test 4: Data Display -->
        <div class="test-section">
            <h3>Test 4: Data Display Module</h3>
            <button id="testDataDisplay" class="btn btn-primary">Test Data Display</button>
            <div id="dataDisplayContainer"></div>
        </div>
        
        <!-- Test 5: Button Handler -->
        <div class="test-section">
            <h3>Test 5: Button Handler Module</h3>
            <button id="testButton" class="btn btn-secondary">Test Button</button>
            <div id="buttonHandlerResult"></div>
        </div>
        
        <!-- Test 6: Complete Controller -->
        <div class="test-section">
            <h3>Test 6: Complete Data Tab Controller</h3>
            <button id="testController" class="btn btn-success">Test Complete Controller</button>
            <div id="controllerResult"></div>
        </div>
        
        <!-- Debug Log -->
        <div class="test-section">
            <h3>Debug Log</h3>
            <div id="debugLog" class="bg-light p-3" style="height: 200px; overflow-y: auto; font-family: monospace; font-size: 12px;">
                <!-- Debug messages will appear here -->
            </div>
        </div>
    </div>

    <!-- Load modules -->
    <script src="redline/web/static/js/modules/file-loader.js"></script>
    <script src="redline/web/static/js/modules/data-loader.js"></script>
    <script src="redline/web/static/js/modules/file-selector.js"></script>
    <script src="redline/web/static/js/modules/data-display.js"></script>
    <script src="redline/web/static/js/modules/button-handler.js"></script>
    <script src="redline/web/static/js/modules/data-tab-controller.js"></script>

    <script>
    function log(message) {
        const debugLog = document.getElementById('debugLog');
        if (debugLog) {
            const timestamp = new Date().toLocaleTimeString();
            debugLog.innerHTML += `<div>[${timestamp}] ${message}</div>`;
            debugLog.scrollTop = debugLog.scrollHeight;
        }
        console.log(`[TEST] ${message}`);
    }

    function showResult(elementId, message, type = 'info') {
        const element = document.getElementById(elementId);
        element.innerHTML = `<div class="test-result test-${type}">${message}</div>`;
    }

    // Test 1: File Loader
    document.getElementById('testFileLoader').addEventListener('click', async () => {
        log('Testing File Loader...');
        try {
            const fileLoader = new FileLoader();
            fileLoader.setOnFilesLoaded((files) => {
                showResult('fileLoaderResult', `✅ File Loader Success: Loaded ${files.length} files`, 'success');
                log(`File Loader: Loaded ${files.length} files`);
            });
            fileLoader.setOnError((error) => {
                showResult('fileLoaderResult', `❌ File Loader Error: ${error.message}`, 'error');
                log(`File Loader Error: ${error.message}`);
            });
            
            await fileLoader.loadFiles();
        } catch (error) {
            showResult('fileLoaderResult', `❌ File Loader Error: ${error.message}`, 'error');
            log(`File Loader Error: ${error.message}`);
        }
    });

    // Test 2: File Selector
    document.addEventListener('DOMContentLoaded', () => {
        const fileSelector = new FileSelector('testFileSelect');
        fileSelector.setOnSelectionChanged((filename) => {
            showResult('fileSelectorResult', `✅ File Selected: ${filename}`, 'success');
            log(`File Selector: Selected ${filename}`);
        });
        fileSelector.setupEventHandlers();
        
        // Simulate adding files
        const testFiles = [
            { name: 'test1.csv', size: 1024 },
            { name: 'test2.csv', size: 2048 }
        ];
        fileSelector.populateFiles(testFiles);
        showResult('fileSelectorResult', '✅ File Selector: Populated with test files', 'success');
    });

    // Test 3: Data Loader
    document.getElementById('testDataLoader').addEventListener('click', async () => {
        log('Testing Data Loader...');
        try {
            const dataLoader = new DataLoader();
            dataLoader.setOnDataLoaded((dataInfo) => {
                showResult('dataLoaderResult', `✅ Data Loader Success: Loaded ${dataInfo.totalRows} rows`, 'success');
                log(`Data Loader: Loaded ${dataInfo.totalRows} rows`);
            });
            dataLoader.setOnError((error) => {
                showResult('dataLoaderResult', `❌ Data Loader Error: ${error.message}`, 'error');
                log(`Data Loader Error: ${error.message}`);
            });
            
            // Test with a known file
            await dataLoader.loadData('AAPL_yahoo_2024-01-01_to_2024-01-31.csv');
        } catch (error) {
            showResult('dataLoaderResult', `❌ Data Loader Error: ${error.message}`, 'error');
            log(`Data Loader Error: ${error.message}`);
        }
    });

    // Test 4: Data Display
    document.getElementById('testDataDisplay').addEventListener('click', () => {
        log('Testing Data Display...');
        try {
            const dataDisplay = new DataDisplay('dataDisplayContainer');
            
            // Test with sample data
            const sampleData = [
                { name: 'Apple', price: 150.25, volume: 1000000 },
                { name: 'Google', price: 2800.50, volume: 500000 }
            ];
            
            dataDisplay.displayData(sampleData);
            showResult('dataDisplayResult', '✅ Data Display: Sample data displayed', 'success');
            log('Data Display: Sample data displayed successfully');
        } catch (error) {
            showResult('dataDisplayResult', `❌ Data Display Error: ${error.message}`, 'error');
            log(`Data Display Error: ${error.message}`);
        }
    });

    // Test 5: Button Handler
    document.addEventListener('DOMContentLoaded', () => {
        const buttonHandler = new ButtonHandler('testButton');
        buttonHandler.setOnClick(() => {
            showResult('buttonHandlerResult', '✅ Button Handler: Button clicked successfully', 'success');
            log('Button Handler: Button clicked');
        });
        buttonHandler.setOnStateChanged((enabled) => {
            log(`Button Handler: State changed - ${enabled ? 'enabled' : 'disabled'}`);
        });
        buttonHandler.setupClickHandler();
        buttonHandler.enable();
        
        showResult('buttonHandlerResult', '✅ Button Handler: Initialized and enabled', 'success');
    });

    // Test 6: Complete Controller
    document.getElementById('testController').addEventListener('click', () => {
        log('Testing Complete Controller...');
        try {
            // This would test the complete integration
            showResult('controllerResult', '✅ Controller: All modules loaded successfully', 'success');
            log('Controller: All modules loaded successfully');
        } catch (error) {
            showResult('controllerResult', `❌ Controller Error: ${error.message}`, 'error');
            log(`Controller Error: ${error.message}`);
        }
    });

    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
        log('Module testing page loaded');
        log('Available modules: ' + Object.keys(window).filter(key => key.includes('FileLoader') || key.includes('DataLoader') || key.includes('FileSelector') || key.includes('DataDisplay') || key.includes('ButtonHandler') || key.includes('DataTabController')));
    });
    </script>
</body>
</html>
