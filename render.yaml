services:
  - type: web
    name: redline-backend
    env: docker
    # Use bytecode-optimized Docker image
    image: keepdevops/redline:latest
    dockerCommand: gunicorn --bind 0.0.0.0:$PORT --workers ${GUNICORN_WORKERS:-1} --threads ${GUNICORN_THREADS:-4} --timeout ${GUNICORN_TIMEOUT:-120} --worker-class gthread --access-logfile - --error-logfile - web_app:create_app()
    plan: starter
    envVars:
      - key: FLASK_ENV
        value: production
      - key: FLASK_APP
        value: web_app.py
      - key: PORT
        value: "8080"
      - key: HOST
        value: 0.0.0.0
      - key: GUNICORN_WORKERS
        value: "1"
      - key: GUNICORN_THREADS
        value: "4"
      - key: GUNICORN_TIMEOUT
        value: "120"
    # Healthcheck disabled - causes issues with DuckDB single-worker constraint
    # healthCheckPath: /health
    # healthCheckTimeout: 100

